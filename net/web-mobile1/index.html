<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Cocos Creator | vigorPoker</title>
<!--http://www.html5rocks.com/en/mobile/mobifying/-->
<meta content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1,minimal-ui=true" name="viewport"/>
<!--https://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="telephone=no" name="format-detection"/>
<!-- force webkit on 360 -->
<meta content="webkit" name="renderer"/>
<meta content="webkit" name="force-rendering"/>
<!-- force edge on IE -->
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<meta content="no" name="msapplication-tap-highlight"/>
<!-- force full screen on some browser -->
<meta content="yes" name="full-screen"/>
<meta content="true" name="x5-fullscreen"/>
<meta content="true" name="360-fullscreen"/>
<!--fix fireball/issues/3568 -->
<!--<meta name="browsermode" content="application">-->
<meta content="app" name="x5-page-mode"/>
<!--<link rel="apple-touch-icon" href=".png" />-->
<!--<link rel="apple-touch-icon-precomposed" href=".png" />-->
<link href="style.f76d1.css" rel="stylesheet" type="text/css"/>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
    body, html {
      /*background: linear-gradient(to bottom, #052826, #071816);*/
      background-color: #000000;
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #GameDiv {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #Cocos3dGameContainer {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #GameCanvas {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
    }

    #centerImage {
      position: absolute;
      width: 28vw;  /* 宽度为屏幕宽度的28% */
      height: auto; /* 根据宽度自动调整高度 */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    </style>
</head>
<body>
<div cc_exact_fit_screen="true" id="GameDiv">
<div id="Cocos3dGameContainer">
<canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="99"></canvas>
<img alt="Centered Image" id="centerImage" src="loading.png"/></div>
</div>
<!-- Polyfills bundle. -->
<script charset="utf-8" src="src/polyfills.bundle.5adbf.js"> </script>
<!-- SystemJS support. -->
<script charset="utf-8" src="src/system.bundle.36d3c.js"> </script>
<!-- Import map -->
<script charset="utf-8" src="src/import-map.76a00.json" type="systemjs-importmap"> </script>
<script>
    System.import('./index.0c0ea.js').catch(function(err) { console.error(err); })
</script>
<script>
  let searchParams1 = new URLSearchParams(window.location.search);
  if (searchParams1.get("scheme")) {
    download();
  }

  async function onCall(msg) {
    var txt = decodeURIComponent(msg);
    var data = JSON.parse(txt);
        if(data.ReqId == 1){
      window["FCMtoken"] = data.Msg;
    }else if(data.ReqId == 2){
      const customEvent = new CustomEvent("googleInfoH5", {
        detail: data.Msg
      });
      window.dispatchEvent(customEvent);
    }
    //alert(data.ReqId + " : " + data.Msg); 
  }

  async function download() {
    let data = {
      ReqId: 1,
    };
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = `uniwebview://message?call=${encodeURIComponent(JSON.stringify(data))}`;
    document.body.appendChild(iframe);
    setTimeout(() => document.body.removeChild(iframe), 1000);
  }
</script>
<script>
  let searchParams = new URLSearchParams(window.location.search);
  window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('Cocos3dGameContainer');
    const img = document.createElement('img');
    img.id = 'loadimg';
    img.alt = 'Centered Image';
    img.src = 'loadingH5.png';
    img.style.position = 'absolute';
    img.style.top = '0';
    img.style.left = '0';
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'cover';
    img.style.zIndex = 999;

    document.body.appendChild(img);
  });
</script>
<!-- ✅ 动态加载 af-helper.js，仅在 pwa 模式下 -->
<script>
  (function() {
    const params = new URLSearchParams(window.location.search);
    if (params.get('pwa')) {
      const script = document.createElement('script');
      script.src = './af-helper.js';
      script.defer = true;
      document.body.appendChild(script);
      console.log('[AF] 已检测到 pwa 参数，正在加载 af-helper.js');
    } else {
      console.log('[AF] 非 pwa 模式，不加载 af-helper.js');
    }
  })();
</script>

<script>
        const tg = window.Telegram.WebApp;
        tg.isClosingConfirmationEnabled = true;
        Telegram.WebApp.expand();
        window.Telegram.WebApp.disableVerticalSwipes();
        let startParam = window.Telegram.WebApp.initDataUnsafe.start_param;
        window.startParam = startParam;
        Telegram.WebApp.ready();
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        window.user = user;
        window.initData = window.Telegram.WebApp.initData;
        document.addEventListener("DOMContentLoaded", function() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /mobile|android|iphone|ipad|phone/i.test(userAgent);
            if (isMobile) {
                console.log('Mobile Device');
                window.device = "Mobile";
            } else {
                console.log('Desktop Device');
                window.device = "Desktop";
            }
        });
    </script>
</body>
</html>
